# Modello M2 - Analisi di Regressione Lineare Multipla

## Obiettivo del Codice

Il file `m2.py` implementa una **regressione lineare multipla** per analizzare la relazione tra **tre variabili esplicative** (BMI, età e numero di figli) e i **costi assicurativi sanitari** utilizzando Python con integrazione R tramite la libreria `rpy2`.

### Variabili Analizzate
- **Variabile dipendente (y)**: Charges (costi assicurativi)
- **Variabili indipendenti**:
  - **x1**: BMI (Body Mass Index)
  - **x2**: Age (età dell'assicurato)
  - **x3**: Children (numero di figli a carico)

### Modello di Regressione
Il modello implementato è: **charges ~ bmi + age + children**

## Dataset

Il dataset `insurance.csv` contiene informazioni su 1338 assicurati con le seguenti variabili:

- **age**: Età dell'assicurato
- **sex**: Sesso (male/female)
- **bmi**: Indice di Massa Corporea (Body Mass Index)
- **children**: Numero di figli a carico
- **smoker**: Stato di fumatore (yes/no)
- **region**: Regione geografica (southwest, southeast, northwest, northeast)
- **charges**: Costi assicurativi (variabile target)

## Metodologia

### 1. Caricamento dei Dati
- Lettura del dataset `insurance.csv` tramite R
- Selezione delle variabili BMI, età, numero di figli e costi assicurativi per l'analisi

### 2. Analisi Esplorativa Multivariata
- **Statistiche descrittive** delle quattro variabili
- **Matrice di varianza-covarianza** completa
- **Matrice di correlazione** tra tutte le variabili del modello

### 3. Visualizzazioni Generate
Il codice produce due grafici principali:

#### Matrice di Dispersione (Scatter Plot Matrix)
![Matrice di Dispersione](m2_dispersion.png)

La matrice di dispersione mostra le relazioni bivariatetra tutte le coppie di variabili del modello (charges, BMI, age, children), permettendo di visualizzare:
- La distribuzione di ciascuna variabile (diagonale)
- Le relazioni lineari e non lineari tra le variabili
- La presenza di outliers e pattern nei dati

#### Valori Predetti vs Valori Osservati
![Fitted vs Observed](m2_sy_vs_y.png)

Questo grafico confronta i valori predetti dal modello con i valori osservati dei costi assicurativi:
- La **linea rossa** rappresenta la relazione ideale perfetta (pendenza = 1)
- La vicinanza dei punti alla linea rossa indica la qualità delle predizioni
- La dispersione dei punti mostra l'errore di predizione del modello

### 4. Modello di Regressione Lineare Multipla
- Stima simultanea dei parametri per tutte le variabili esplicative
- Analisi dei coefficienti di regressione parziali
- Valutazione della qualità del modello (R-squared, F-test, t-test per ogni coefficiente)

## Risultati Dettagliati del Modello M2

### Statistical Summary of Variables
```
       y               x1              x2              x3       
 Min.   : 1122   Min.   :15.96   Min.   :18.00   Min.   :0.000  
 1st Qu.: 4740   1st Qu.:26.30   1st Qu.:27.00   1st Qu.:0.000  
 Median : 9382   Median :30.40   Median :39.00   Median :1.000  
 Mean   :13270   Mean   :30.66   Mean   :39.21   Mean   :1.095  
 3rd Qu.:16640   3rd Qu.:34.69   3rd Qu.:51.00   3rd Qu.:2.000  
 Max.   :63770   Max.   :53.13   Max.   :64.00   Max.   :5.000  
```

**Interpretazione delle Statistiche Descrittive:**
- **Charges (y)**: Invariate rispetto a M1 ($1,122 - $63,770, media $13,270)
- **BMI (x1)**: Invariate rispetto a M1 (15.96 - 53.13, media 30.66)
- **Age (x2)**: Età da 18 a 64 anni, con mediana di 39 anni e media di 39.21 anni
- **Children (x3)**: Da 0 a 5 figli, con mediana di 1 figlio e media di 1.095 figli

### Variance of Variables
```
              y           x1           x2           x3
y  1.466524e+08 1.464730e+04 5.087480e+04 992.67419705
x1 1.464730e+04 3.718788e+01 9.362337e+00   0.09379476
x2 5.087480e+04 9.362337e+00 1.974014e+02   0.71930275
x3 9.926742e+02 9.379476e-02 7.193027e-01   1.45321275
```

**Analisi della Matrice di Varianza-Covarianza:**
- **Varianza dei costi (y)**: 146,652,372 (invariata rispetto a M1)
- **Varianza dell'età (x2)**: 197.4 anni² (moderata variabilità)
- **Varianza del numero di figli (x3)**: 1.45 (bassa variabilità)
- **Covarianze positive**: Tutte le variabili mostrano covarianze positive con i costi

### Correlation Index between Variables
```
            y        x1        x2         x3
y  1.00000000 0.1983410 0.2990082 0.06799823
x1 0.19834097 1.0000000 0.1092719 0.01275890
x2 0.29900819 0.1092719 1.0000000 0.04246900
x3 0.06799823 0.0127589 0.0424690 1.00000000
```

**Analisi della Matrice di Correlazione:**
- **Charges vs Age**: r = 0.299 (correlazione moderata, la più forte)
- **Charges vs BMI**: r = 0.198 (correlazione debole, come in M1)
- **Charges vs Children**: r = 0.068 (correlazione molto debole)
- **Correlazioni tra predittori**: Tutte molto basse (< 0.11), indicando **assenza di multicollinearità**

### Summary of Linear Model M2

```
Call:
lm(formula = y ~ x1 + x2 + x3)

Residuals:
   Min     1Q Median     3Q    Max 
-13884  -6994  -5092   7125  48627 

Coefficients:
            Estimate Std. Error t value Pr(>|t|)    
(Intercept) -6916.24    1757.48  -3.935 8.74e-05 ***
x1            332.08      51.31   6.472 1.35e-10 ***
x2            239.99      22.29  10.767  < 2e-16 ***
x3            542.86     258.24   2.102   0.0357 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 11370 on 1334 degrees of freedom
Multiple R-squared:  0.1201,    Adjusted R-squared:  0.1181 
F-statistic: 60.69 on 3 and 1334 DF,  p-value: < 2.2e-16
```

## Risultati Principali

### Equazione del Modello
**charges = -6916.24 + 332.08×BMI + 239.99×Age + 542.86×Children**

### Interpretazione Dettagliata dei Coefficienti

#### Intercetta (-6916.24)
- **Valore**: -$6,916.24
- **Errore Standard**: $1,757.48
- **t-value**: -3.935
- **p-value**: 8.74e-05 (altamente significativo ***)
- **Interpretazione**: Costo assicurativo base (teorico) per una persona con BMI=0, età=0 e figli=0

#### Coefficiente BMI (332.08)
- **Valore**: $332.08 per unità di BMI
- **Errore Standard**: $51.31
- **t-value**: 6.472
- **p-value**: 1.35e-10 (altamente significativo ***)
- **Interpretazione**: **Tenendo costanti età e numero di figli, ogni aumento di 1 unità di BMI comporta un aumento medio di $332 nei costi**

#### Coefficiente Age (239.99)
- **Valore**: $239.99 per anno di età
- **Errore Standard**: $22.29
- **t-value**: 10.767
- **p-value**: < 2e-16 (altamente significativo ***)
- **Interpretazione**: **Tenendo costanti BMI e numero di figli, ogni anno di età in più comporta un aumento medio di $240 nei costi**

#### Coefficiente Children (542.86)
- **Valore**: $542.86 per figlio
- **Errore Standard**: $258.24
- **t-value**: 2.102
- **p-value**: 0.0357 (significativo *)
- **Interpretazione**: **Tenendo costanti BMI ed età, ogni figlio aggiuntivo comporta un aumento medio di $543 nei costi**

### Qualità del Modello

#### Coefficiente di Determinazione
- **R-squared**: 0.1201 (12.01%)
- **Adjusted R-squared**: 0.1181 (11.81%)
- **Interpretazione**: **Il modello spiega il 12.01% della variabilità nei costi assicurativi**

#### Test F
- **F-statistic**: 60.69 su 3 e 1334 gradi di libertà
- **p-value**: < 2.2e-16 (altamente significativo)
- **Conclusione**: Il modello nel complesso è altamente significativo

#### Analisi dei Residui
- **Errore Standard Residuo**: $11,370 (miglioramento rispetto a M1: $11,870)
- **Range dei Residui**: da -$13,884 a +$48,627 (miglioramento rispetto a M1)
- **Distribuzione**: I residui mostrano una distribuzione più simmetrica rispetto al modello M1

## Confronto con il Modello M1

### Miglioramenti Significativi
1. **Capacità Predittiva**: R² aumenta dal 3.93% (M1) al 12.01% (M2) - **miglioramento di 3.05 volte**
2. **Errore Standard**: Diminuisce da $11,870 (M1) a $11,370 (M2)
3. **Significatività**: Tutti i coefficienti sono significativi, inclusa l'intercetta
4. **Range dei Residui**: Miglioramento nella distribuzione degli errori

### Coefficiente BMI
- **M1**: $393.87 per unità di BMI
- **M2**: $332.08 per unità di BMI
- **Differenza**: Il coefficiente diminuisce di $61.79, mostrando l'**effetto di confondimento** delle variabili omesse in M1

## Limitazioni e Osservazioni

1. **Capacità Predittiva Limitata**: Anche se migliorata, il 12.01% di varianza spiegata indica che molti fattori importanti non sono inclusi
2. **Variabili Omesse**: Il modello non include variabili cruciali come stato di fumatore, sesso, regione
3. **Linearità**: Il modello assume relazioni lineari che potrebbero non essere ottimali
4. **Outliers**: Presenza di residui elevati che potrebbero influenzare le stime

## Conclusioni

Il **Modello M2** rappresenta un significativo miglioramento rispetto al modello univariato M1:

### Punti di Forza
- **Tutti i regressori sono statisticamente significativi** (inclusa l'intercetta)
- **Capacità predittiva triplicata** rispetto a M1 (12.01% vs 3.93%)
- **Assenza di multicollinearità** tra le variabili esplicative
- **Interpretazione economica chiara** di ogni coefficiente

### Implicazioni Pratiche
- **Età** è il predittore più importante (t-value = 10.767)
- **BMI** mantiene un effetto significativo ma ridotto rispetto a M1
- **Numero di figli** ha un impatto economicamente rilevante (+$543 per figlio)
- Il modello fornisce stime più accurate per la determinazione dei premi assicurativi

Il **Modello M2** dimostra chiaramente l'importanza dell'analisi multivariata nell'identificazione dei fattori che influenzano i costi assicurativi sanitari.